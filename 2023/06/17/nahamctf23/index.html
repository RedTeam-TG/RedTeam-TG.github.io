

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>




<!-- Mirrored from l3ak.team/2023/06/17/nahamctf23/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 19 May 2025 17:30:25 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="../../../../img/fluid.png">
  <link rel="icon" href="../../../../members/flag.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Suvoni">
  <meta name="keywords" content="">
  
    <meta name="description" content="Writeup for Signed Jeopardy from NahamConCTF 2023.">
<meta property="og:type" content="article">
<meta property="og:title" content="NahamconCTF - [Signed Jeopardy] - Crypto">
<meta property="og:url" content="http://example.com/2023/06/17/nahamctf23/index.html">
<meta property="og:site_name" content="L3ak">
<meta property="og:description" content="Writeup for Signed Jeopardy from NahamConCTF 2023.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="../../../../../example.com/images/nahamctf23/thumb.html">
<meta property="article:published_time" content="2023-06-18T00:00:00.000Z">
<meta property="article:modified_time" content="2024-04-23T07:39:33.704Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="../../../../../example.com/images/nahamctf23/thumb.html">
  
  
  
  <title>NahamconCTF - [Signed Jeopardy] - Crypto - L3ak</title>

  <link  rel="stylesheet" href="../../../../../lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="../../../../../lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="../../../../../lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="../../../../../lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ‰∏ªÈ¢ò‰æùËµñÁöÑÂõæÊ†áÂ∫ìÔºå‰∏çË¶ÅËá™Ë°å‰øÆÊîπ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="../../../../../at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="../../../../../at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="../../../../css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="../../../../css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="../../../../css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":50,"cursorChar":"|","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="../../../../js/utils.js" ></script>
  <script  src="../../../../js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.1.1"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="../../../../index.html">
      <strong>L3ak CTF üö©</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../../../index.html" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../../../members/index.html" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>Members</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('../../../../null.html') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="NahamconCTF - [Signed Jeopardy] - Crypto"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        Suvoni
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-06-17 20:00" pubdate>
          June 17, 2023 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          561 words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          5 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">NahamconCTF - [Signed Jeopardy] - Crypto</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="Signed-Jeopardy"><a href="#Signed-Jeopardy" class="headerlink" title="Signed Jeopardy"></a>Signed Jeopardy</h1><p><img src="../../../../images/nahamctf23/into.png" srcset="/img/loading.gif" lazyload alt="challenge"></p>
<div class="note note-warning">
            <p><strong>Difficulty:</strong> <strong>Medium</strong><br><strong>Category:</strong> <strong>Cryptography</strong><br><strong>Flag:</strong> <strong><code>flag{a8168c41537604546394c13c8f4ef4b8}</code></strong></p>
          </div>

<p>This writeup covers the challenge Signed Jeopardy from NahamConCTF 2023, which was probably the hardest crypto challenge in the competition, with only 44 solves. </p>
<p>In this challenge, we are given a file <code>server.sage</code> which implements the Elliptic Curve Digital Signature Algorithm (ECDSA) on the P521 curve. After generating the public key, the program opens a file called <code>questions.txt</code> and randomly selects questions about video game history and lore. It signs the answer to those questions and prints the question and signed answer to the console. The user can choose to receive questions and signed answers, and can also choose to sign a custom message. If the signature of the user‚Äôs message equals the signature calculated by the program, it gives the flag.</p>
<p><strong>server.sage:</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randint<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha512<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;flag.txt&quot;</span>,<span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>	flag = f.read()<br><br>questions = []<br>answers = []<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;questions.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>	<span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> f.readlines():<br>		a = x.split(<span class="hljs-string">&#x27;\t&#x27;</span>)<br>		questions.append(a[<span class="hljs-number">0</span>])<br>		answers.append(a[<span class="hljs-number">1</span>][:-<span class="hljs-number">1</span>])<br><br><span class="hljs-comment"># P521 standard curve parameters</span><br>p = <span class="hljs-number">6864797660130609714981900799081393217269435300143305409394463459185543183397656052122559640661454554977296311391480858037121987999716643812574028291115057151</span><br>a = <span class="hljs-number">6864797660130609714981900799081393217269435300143305409394463459185543183397656052122559640661454554977296311391480858037121987999716643812574028291115057148</span><br>b = <span class="hljs-number">1093849038073734274511112390766805569936207598951683748994586394495953116150735016013708737573759623248592132296706313309438452531591012912142327488478985984</span><br>Gx = <span class="hljs-number">2661740802050217063228768716723360960729859168756973147706671368418802944996427808491545080627771902352094241225065558662157113545570916814161637315895999846</span><br>Gy = <span class="hljs-number">3757180025770020463545507224491183603594455134769762486694567779615544477440556316691234405012945539562144444537289428522585666729196580810124344277578376784</span><br>E = EllipticCurve(GF(p), [a, b])<br>G = E(Gx, Gy)<br>n = <span class="hljs-number">6864797660130609714981900799081393217269435300143305409394463459185543183397655394245057746333217197532963996371363321113864768612440380340372808892707005449</span><br>k = randint(<span class="hljs-number">1</span>,n-<span class="hljs-number">1</span>)<br>d = randint(<span class="hljs-number">1</span>,n-<span class="hljs-number">1</span>)<br>Pub = d*G<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">menu</span>():<br>	<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nWhat service would you like?&quot;</span>)<br>	<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\t1. Question&quot;</span>)<br>	<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\t2. Flag&quot;</span>)<br>	<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\t3. Quit&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sign</span>():<br>	index = randint(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(questions)-<span class="hljs-number">1</span>)<br>	question = questions[index]<br>	answer = <span class="hljs-string">&quot;What is &quot;</span>+answers[index].upper()+<span class="hljs-string">&quot;?&quot;</span><br>	m_hash = <span class="hljs-built_in">int</span>(sha512(answer.encode()).hexdigest(), <span class="hljs-number">16</span>)<br>	P = k*G<br>	r = <span class="hljs-built_in">int</span>(P[<span class="hljs-number">0</span>]) % n<br>	s = ((m_hash + (r*d))/k)%n<br>	<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Here is the question: <span class="hljs-subst">&#123;question&#125;</span>\nAnd here is the signature: (<span class="hljs-subst">&#123;r&#125;</span>, <span class="hljs-subst">&#123;s&#125;</span>)&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_flag</span>():<br>	<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Please give the message&quot;</span>)<br>	message = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;&quot;</span>)<br>	<span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> answers:<br>		<span class="hljs-keyword">if</span> a.casefold() <span class="hljs-keyword">in</span> message.casefold():<br>			<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;I can&#x27;t have you using the answer of one of the questions as the message!&quot;</span>)<br>			quit()<br>	<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Please give the r value of the signature&quot;</span>)<br>	r_given = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;&quot;</span>))<br>	<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Please give the s value of the signature&quot;</span>)<br>	s_given = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;&quot;</span>))<br>	m_hash = <span class="hljs-built_in">int</span>(sha512(message.encode()).hexdigest(), <span class="hljs-number">16</span>)<br>	P = k*G<br>	r = <span class="hljs-built_in">int</span>(P[<span class="hljs-number">0</span>]) % n<br>	s = ((m_hash + (r*d))/k)%n<br>	<span class="hljs-keyword">if</span> r == r_given <span class="hljs-keyword">and</span> s == s_given:<br>		<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;As promised, here&#x27;s your flag --&gt; <span class="hljs-subst">&#123;flag&#125;</span>&quot;</span>)<br>		quit()<br>	<span class="hljs-keyword">else</span>:<br>		<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Not the right signature. HAHAHA!&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>	<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Welcome to my ECDSA Jeopardy!\nHere is the public key:\nPublic key = <span class="hljs-subst">&#123;Pub&#125;</span>\nI&#x27;ll sign the answers and give them to you.&quot;</span>)<br>	<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>		menu()<br>		choice = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;&quot;</span>))<br>		<span class="hljs-keyword">if</span> choice == <span class="hljs-number">1</span>:<br>			sign()<br>		<span class="hljs-keyword">elif</span> choice == <span class="hljs-number">2</span>:<br>			get_flag()<br>		<span class="hljs-keyword">elif</span> choice == <span class="hljs-number">3</span>:<br>			quit()<br>		<span class="hljs-keyword">else</span>:<br>			<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Invalid choice. Please try again.&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>	main()<br></code></pre></td></tr></table></figure>

<p>After careful inspection of the code in <code>server.sage</code>, one can observe that the same nonce value <code>k</code> is reused to sign every answer. This is a critical implementation flaw in the ECDSA and the vulnerability which we will exploit in this challenge to retrieve the flag.</p>
<p>In the ECDSA, a random nonce value <code>k</code> is generated for each signature creation. The nonce value is used in conjunction with the private key to compute a point on the elliptic curve, which is in turn transformed into a valid signature. Since the purpose of the nonce is to provide randomness (uniqueness) to the signature generation process, it is of vital importance that <code>k</code> remains secret and is never reused. If it is reused, the attacker can directly compute <code>k</code> and the private key <code>d</code> and then forge signatures for arbitrary messages. As explained <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm">here</a>, if we have two messages <code>m1</code> and <code>m2</code> and their signatures <code>(r,s1)</code> and <code>(r,s2)</code>, we can compute the message hashes <code>z1</code> and <code>z2</code> and compute <code>k</code> and <code>d</code> by:</p>
<p><img src="../../../../images/nahamctf23/eqn.png" srcset="/img/loading.gif" lazyload alt="eqn"></p>
<p>Thus, if we can select two questions from the server to answer - making sure to record the answer signatures - we can recompute <code>k</code> and <code>d</code> using the equations above. Then, we can choose an example message (such as ‚Äúhello‚Äù) and compute its signature using the recovered values. Since we generate the signature using the same <code>k</code> and <code>d</code> used by the server, our signature should match the one computed by the server and we should be able to retrieve the flag!</p>
<p>First, let‚Äôs choose two simple questions to answer:<br><img src="../../../../images/nahamctf23/intro_msg.png" srcset="/img/loading.gif" lazyload alt="intro_msg"><br><img src="../../../../images/nahamctf23/question1.png" srcset="/img/loading.gif" lazyload alt="question 1"><br><img src="../../../../images/nahamctf23/question2.png" srcset="/img/loading.gif" lazyload alt="question 2"></p>
<p>The answers to these questions are Microsoft and Mythical, respectively. Note that these are our messages <code>m1</code> and <code>m2</code>, and we can compute their hashes to find <code>z1</code> and <code>z2</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> * <span class="hljs-comment"># For elliptic curves</span><br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha512 <span class="hljs-comment"># For hasing the message (we actually sign the HASH of the message, not the message itself)</span><br><span class="hljs-keyword">from</span> ecdsa.numbertheory <span class="hljs-keyword">import</span> inverse_mod <span class="hljs-comment"># inverse_mod == division (when moduli are involved)</span><br><br><span class="hljs-comment"># P521 standard curve parameters (from &#x27;server.sage&#x27;)</span><br>p = <span class="hljs-number">6864797660130609714981900799081393217269435300143305409394463459185543183397656052122559640661454554977296311391480858037121987999716643812574028291115057151</span><br>a = <span class="hljs-number">6864797660130609714981900799081393217269435300143305409394463459185543183397656052122559640661454554977296311391480858037121987999716643812574028291115057148</span><br>b = <span class="hljs-number">1093849038073734274511112390766805569936207598951683748994586394495953116150735016013708737573759623248592132296706313309438452531591012912142327488478985984</span><br>Gx = <span class="hljs-number">2661740802050217063228768716723360960729859168756973147706671368418802944996427808491545080627771902352094241225065558662157113545570916814161637315895999846</span><br>Gy = <span class="hljs-number">3757180025770020463545507224491183603594455134769762486694567779615544477440556316691234405012945539562144444537289428522585666729196580810124344277578376784</span><br>E = EllipticCurve(GF(p), [a, b])<br>G = E(Gx, Gy) <br>n = <span class="hljs-number">6864797660130609714981900799081393217269435300143305409394463459185543183397655394245057746333217197532963996371363321113864768612440380340372808892707005449</span><br><br><span class="hljs-comment"># Note: n == the order of G (G == elliptic curve base point) which represents the total</span><br><span class="hljs-comment"># number of different possible points over the curve </span><br><br><span class="hljs-comment"># Question 1: Rare was bought by this company for $3.19 billion.</span><br>m1 = <span class="hljs-string">&quot;What is &quot;</span> + <span class="hljs-string">&quot;Microsoft&quot;</span>.upper() + <span class="hljs-string">&quot;?&quot;</span><br><br><span class="hljs-comment"># Question 2: Category of Pokemon that contain some Pokemon like Victini, Mew, Magearna and Zarude.</span><br>m2 = <span class="hljs-string">&quot;What is &quot;</span> + <span class="hljs-string">&quot;Mythical&quot;</span>.upper() + <span class="hljs-string">&quot;?&quot;</span><br><br><span class="hljs-comment"># Compute the SHA512 hashes of the answers</span><br>z1 = <span class="hljs-built_in">int</span>(sha512(m1.encode()).hexdigest(), <span class="hljs-number">16</span>)<br>z2 = <span class="hljs-built_in">int</span>(sha512(m2.encode()).hexdigest(), <span class="hljs-number">16</span>)<br></code></pre></td></tr></table></figure>

<p>Now that we have the hashes, we can use the signatures obtained from the server, <code>(r,s1)</code> and <code>(r,s2)</code>, to recover <code>k</code> and <code>d</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment"># Signature (r1, s1) of the first answer</span><br>r1 = <span class="hljs-number">1465592089909096066855017733143775914413407269725815519508066282537319512650079216133639660455072377153032233958108330075714003734901092347020299988719621322</span><br>s1 = <span class="hljs-number">545531076356108942170542517291585227912890321475211086646343990428230857512990453752368923962766593723868745103465428375270149723925686204794806188631057460</span><br><br><span class="hljs-comment"># Signature (r2, s2) of the second answer</span><br>r2 = <span class="hljs-number">1465592089909096066855017733143775914413407269725815519508066282537319512650079216133639660455072377153032233958108330075714003734901092347020299988719621322</span><br>s2 = <span class="hljs-number">4189612857039624039238953485069358484257973951950638665234391677969348904883268302761678805371275339935843305522229259291269025045916960785357191121407045404</span><br><br><span class="hljs-comment"># r must be equal for this to work (this is assumed, but we check just in case)</span><br><span class="hljs-keyword">assert</span>(r1 == r2)<br><br><span class="hljs-comment"># In the Elliptic Curve Digital Signature Algorithm, if the same k is used to sign</span><br><span class="hljs-comment"># different signatures (which is the case here), the attacker can recover k using</span><br><span class="hljs-comment"># the signatures (see https://en.wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm):</span><br>m_diff = (z1 - z2) % n<br>r1_inv = inverse_mod(r1, n)<br>s_diff = (s1-s2) % n<br><br><span class="hljs-comment"># Recover k and d using the formulas from the Wikipedia page</span><br><span class="hljs-comment"># Note that division is actually multiplication by the modular inverse!!</span><br>k = (m_diff * inverse_mod(s_diff, n)) % n<br>d = (((((s1 * k) % n) - z1) % n) * r1_inv) % n<br></code></pre></td></tr></table></figure>

<p>Finally, we can use <code>d</code> and <code>k</code> to forge a valid signature for our own message, ‚Äúhello‚Äù:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment"># Now, sign a dummy message with the calculated keys and print out the signature</span><br>m_dummy = <span class="hljs-string">&quot;hello&quot;</span><br>m_dummy_hash = <span class="hljs-built_in">int</span>(sha512(m_dummy.encode()).hexdigest(), <span class="hljs-number">16</span>)<br>P = k*G<br>r = <span class="hljs-built_in">int</span>(P[<span class="hljs-number">0</span>]) % n<br>k_inv = inverse_mod(k, n)<br>s = (((m_dummy_hash + ((r*d)%n)) % n) * k_inv) % n<br><br><span class="hljs-comment"># Print the recovered values (k &amp; d) and the forged signature (r, s) to the console</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;k = <span class="hljs-subst">&#123;k&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;d = <span class="hljs-subst">&#123;d&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;r = <span class="hljs-subst">&#123;r&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;s = <span class="hljs-subst">&#123;s&#125;</span>\n&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>Output:</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">k</span> <span class="hljs-operator">=</span> <span class="hljs-number">3716974158814584297095537945004349475177037436869930102241594403151123939279227740076878779097835920205545515879536767635099702998888815919895730302683232744</span><br><span class="hljs-attribute">d</span> <span class="hljs-operator">=</span> <span class="hljs-number">2127236813394369802820290684263172937266777532372353713359324496964461876839310236381964658762852218580616002669515460043669806824304374603332980809612018763</span><br><span class="hljs-attribute">r</span> <span class="hljs-operator">=</span> <span class="hljs-number">1465592089909096066855017733143775914413407269725815519508066282537319512650079216133639660455072377153032233958108330075714003734901092347020299988719621322</span><br><span class="hljs-attribute">s</span> <span class="hljs-operator">=</span> <span class="hljs-number">1006240130706487892221434509613165618667388551054639964437917316108210445795964748208564217284113625941057144566952722652716045949564018952318007559836194459</span><br></code></pre></td></tr></table></figure>

<p>Here comes the moment of truth! Let‚Äôs submit our message <code>hello</code> and forged signature <code>(r,s)</code> to the server and see if it‚Äôs correct:<br><img src="../../../../images/nahamctf23/flag.png" srcset="/img/loading.gif" lazyload alt="flag"></p>
<p>We got the flag! Moral of the story - <em>never</em> reuse your nonces!</p>
<p>Until next time‚Ä¶</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="../../../10/15/tcp1p/index.html" title="TCP1PCTF 2023 - [Invitation] - Blockchain">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">TCP1PCTF 2023 - [Invitation] - Blockchain</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="../../05/dante/index.html" title="DanteCTF 2023 - [Radio Frequency] - Forensics">
                        <span class="hidden-mobile">DanteCTF 2023 - [Radio Frequency] - Forensics</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io/" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="../../../../../lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="../../../../../lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="../../../../../lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="../../../../../lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="../../../../js/events.js" ></script>
<script  src="../../../../js/plugins.js" ></script>


  <script  src="../../../../../lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="../../../../js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('../../../../../lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=../../../../../lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('../../../../../lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('../../../../../lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="../../../../../lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="../../../../js/local-search.js" ></script>





<!-- ‰∏ªÈ¢òÁöÑÂêØÂä®È°πÔºåÂ∞ÜÂÆÉ‰øùÊåÅÂú®ÊúÄÂ∫ïÈÉ® -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="../../../../js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>

<!-- Mirrored from l3ak.team/2023/06/17/nahamctf23/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 19 May 2025 17:30:27 GMT -->
</html>
